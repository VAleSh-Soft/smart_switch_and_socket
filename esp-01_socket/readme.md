## esp-01_socket
WiFi-реле, построенное на основе **esp-01** (**esp8266**), установленного на готовый однорелейный модуль, например, [такой](https://aliexpress.ru/item/32845077134.html).

- [Двухрелейный вариант](#двухрелейный-вариант)
- [Подключение локальной кнопки](#подключение-локальной-кнопки)
- [Обновление прошивки](#обновление-прошивки)
- [Подключение периферии](#подключение-периферии)
- [Использованные сторонние библиотеки](#использованные-сторонние-библиотеки)


### Двухрелейный вариант
В продаже есть готовые двухрелейные модули для установки на них **esp-01**. Если нужно сделать на основе такого модуля (например, [такого](https://aliexpress.ru/item/1005003619242840.html) ), достаточно будет добавить описание второго реле в массив `relays[]`, указать номер пина, на который заведено управление вторым реле и задать количество реле `relays_count` в файле **header_file.h**:
```
const byte relay2_pin = 2;

const uint8_t relays_count = 2;
```

После чего добавить второе реле с помощью метода `addRelay()` в `setup()`
```
relay_control.addRelay("lamp02", relay2_pin, LOW);
```

Двух свободных пинов для подключения локальных кнопок у **esp-01** нет, поэтому второе реле своей локальной кнопки иметь не будет.

### Подключение локальной кнопки

Локальная кнопка может понадобиться для непосредственного управления модулем. Она подключается к пину `GPIO3` (**Rx**) подпайкой провода к соответствующему пину релейного модуля (не к самой **esp-01**). Если предполагается, что кнопка будет расположена на самом модуле, можно обойтись простым подключением
```
GND -> btn <- GPIO3
```
Но, если необходимо вынести кнопки на расстояние (например, сделать несколько выключателей в разных местах комнаты), то для обеспечения помехоустойчивости, лучше сделать одним из нижеследующих вариантов:

- вариант с гальванической развязкой

![Alt text](doc/001.jpg)

GND и GND1 между собой соединяться не должны.

- вариант без гальванической развязки

![Alt text](doc/002.jpg)

В обоих случаях можно использовать несколько кнопок, соединенных параллельно - нажатие на любую из них будет равнозначно. В качестве проводов лучше использовать витую пару, вынутую из кабеля UTP.

### Обновление прошивки

В модуле есть возможность обновления прошивки "по воздуху" с использованием Web-интерфейса. Доступ к интерфесу обновления выполняется по адресу "http://ip-address/firmware" (где **ip-address** - собственно, IP-адрес модуля в вашей локальной сети), однако адрес можно изменить в функции `server_init()` в файле **header_file.h**
```
// настройка сервера обновлений
httpUpdater.setup(&HTTP, "/firmware");
```
Дополнительно в этом методе можно задать логин и пароль для доступа к интерфейсу обновления.


В интерфейсе обновления нужно выбрать файл с новой прошивкой, нажать на кнопку **Update firmware** и дождаться результата.

### Подключение периферии

Пин для подключения локальной кнопки указан в файле **header_file.h**

### Использованные сторонние библиотеки

- [shSRControl](https://github.com/VAleSh-Soft/shSRControl) - работа с релейными модулями;
- [shWiFiConfig](https://github.com/VAleSh-Soft/shWiFiConfig) - настройка параметров WiFi-соединения;
- [ArduinoJson](https://github.com/bblanchon/ArduinoJson) (код писался с использованием версии 6.21.3) - работа с текстом в формате JSON;

<hr>

Если возникнут вопросы, пишите на valesh-soft@yandex.ru 


Настройки модуля - Generic ESP8266 Module; 1MB(FS:128kB OTA:~438kB);
